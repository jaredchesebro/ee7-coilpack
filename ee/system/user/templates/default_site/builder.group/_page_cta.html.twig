{% set formId = 'form_' ~ loop.index %}
{% set returnUrl = site_url ~ 'thank-you'%}
{% set form = exp.email.contact_form({
    recipients: 'hello@danggood.dev',
    charset: 'utf-8',
    form_class: 'needs-validation',
    form_id: formId,
    redirect: '5',
    return: returnUrl,
    replyto: 'yes',
    form_attributes: {
        "novalidate": "true"
    }
}) %}

{% for row in fluid %}
    {% set bg = '' %}
    {% set textColor = '' %}
    {% set linkColor = 'link-primary' %}
    {% set buttonStyle = 'primary' %}

    {% if row.style|length %}
        {% set bg = 'bg-' ~ row.style %}
        
        {% if row.style == 'primary' %}
            {% set textColor = ' text-white' %}
            {% set linkColor = 'text-reset' %}
            {% set buttonStyle = 'outline-light' %}
        {% endif %}
    {% endif %}

    {% set classes = [bg, 'bg-gradient'] %}

    <section id="{{ fluidId }}" data-block="{{ fluidName }}" class="{{ classes|join(' ') }}">
        <div class="container py-5">
            <div class="row justify-content-center">

                <div class="col-12 col-xl-5{{ textColor }}">
                    {% if row.heading != '' %}<h2>{{ row.heading }}</h2>{% endif %}
                    {% if row.subheading != '' %}<h3>{{ row.subheading }}</h3>{% endif %}
                    {{ row.rich_text|raw }}
                </div>

                <div class="col-xl-5">
                    {{ form.open()|raw }}
                        
                        <div class="row">

                            <div class="col-12 col-lg-6">
                                <div class="form-floating mb-3">
                                    <input type="text" id="firstName" name="firstName" placeholder="First Name" class="form-control" required>
                                    <label for="firstName" class="form-label">First Name</label>
                                    <div class="invalid-feedback">This is a required field.</div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-6">
                                <div class="form-floating mb-3">
                                    <input type="text" id="lastName" name="lastName" placeholder="Last Name" class="form-control" required>
                                    <label for="lastName" class="form-label">Last Name</label>
                                    <div class="invalid-feedback">This is a required field.</div>
                                </div>
                            </div>

                        </div>

                        <div class="mb-3 form-floating">
                            <input type="email" class="form-control" id="from" name="from" placeholder="name@example.com" value="{{ form.member_email }}" aria-describedby="emailHelp" required>
                            <label for="from" class="form-label">Email Address</label>
                            <div id="emailHelp" class="form-text{{ textColor }}">We'll never share your email with anyone else.</div>
                            <div class="invalid-feedback">This is a required field.</div>
                        </div>

                        <div class="form-floating mb-3">
                            <select class="form-select" id="subjectSelect" name="subjectSelect" aria-label="Subject" required>
                                <option value="" selected>Select One</option>
                                <option value="General Inquiry">General Inquiry</option>
                                <option value="Support Request">Support Request</option>
                            </select>
                            <label for="subjectSelect">Subject</label>
                            <div class="invalid-feedback">This is a required field.</div>
                        </div>

                        <div class="mb-3 form-floating">
                            <textarea class="form-control" id="message" name="message" placeholder="Message" style="height: 120px" required></textarea>
                            <label for="message" class="form-label">Message</label>
                            <div class="invalid-feedback">This is a required field.</div>
                        </div>

                        {% if form.captcha|length and form.captcha starts with '<img' %}
                            <div class="mb-3">
                                <label for="captcha" class="form-label fw-bold">Captcha</label>
                                <div class="d-flex flex-row">
                                    <div class="mb-3 flex-grow-1 bg-white p-1">{{ form.captcha|raw }}</div>
                                    <div class="w-100 ps-4">
                                        <input type="text" id="captcha" name="captcha" class="form-control" value="{{ form.captcha_word }}" required>
                                        <div class="invalid-feedback">This is a required field.</div>
                                    </div>
                                </div>
                            </div>
                        {% elseif form.captcha starts with '<script' %}
                            {{ form.captcha|raw }}
                        {% endif %}

                        {# Hidden Fields #}
                        <input type="hidden" id="name" name="name" value="">
                        <input type="hidden" id="subject" name="subject" value="">

                        <button type="submit" class="btn btn-{{ buttonStyle }} shadow">Submit</button>

                        {% if form.captcha starts with '<script' %}
                            <p class="mt-3{{ textColor }}"><small>This site is protected by reCAPTCHA and the Google <a href="https://policies.google.com/privacy" class="{{ linkColor }} link-opacity-75-hover">Privacy Policy</a> and <a href="https://policies.google.com/terms" class="{{ linkColor }} link-opacity-75-hover">Terms of Service</a> apply.</small><p>
                        {% endif %}

                    {{ form.close()|raw }}
                </div>    

            </div>
        </div>
    </section>
{% endfor %}
